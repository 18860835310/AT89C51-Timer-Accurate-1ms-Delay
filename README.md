# AT89C51-Timer-Accurate-1ms-Delay
利用AT89C51的T0计时器（P3^4）精准的控制延时函数进行以1ms为单位延时。

# 程序

## 前置程序
对一些基本参数和文件进行声明定义
```c
#include "reg52.h"

typedef unsigned int u16;
typedef unsigned char u8;

//定义LED1管脚,不需要可以删除，这里为了演示而定义的
sbit LED1 = P2 ^ 0; 

void time0_init(void)
{
	TMOD |= 0x01;  //选择为定时器0模式，工作方式1
	// 定时器初始值在 delay_ms 中设定
	ET0 = 0;       // 关闭定时器0中断（不需要中断）
	EA = 0;        // 关闭总中断（不需要中断）
	TR0 = 0;       // 关闭定时器，防止意外启动
}
```

## 精准延时函数（1ms）
这个是实现精准延时功能的子函数
```c
void delay_ms(u16 ms)
{
    while (ms--)
    {
        TH0 = 0xFC;    //给定时器初始值，定时1ms
        TL0 = 0x66;
        TR0 = 1;       //启动定时器
        while (!TF0);  //等待TF0溢出
        TF0 = 0;       //清除TF0标志
        TR0 = 0;       //关闭定时器
    }
}
```

## 延时在主函数内的调用方法
如何使用延时函数？
首先需要使用 **time0_init()** 打开计时器。
（注：此处计时器是利用单片机内部独立的一个电路进行对机械周期进行计数，由于每一个机械周期都是很精准的时间间隔，所以能达到精准计时的功能，而且不会占用单片机的运行资源）
其次，调用 **delay_ms()** 即可，这里以延时0.5（也就是500ms）切换一次LED灯的状态为例。
```c
void main()
{
	time0_init();  //定时器0初始化配置
	while (1)
	{
		delay_ms(500);  //调用延时函数延时500ms
		LED1 = !LED1;   //切换LED状态
	}
}
```



